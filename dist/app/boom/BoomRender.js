System.register(["lodash", "./BoomUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, BoomUtils_1, BoomRender;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (BoomUtils_1_1) {
                BoomUtils_1 = BoomUtils_1_1;
            }
        ],
        execute: function () {
            BoomRender = (function () {
                function BoomRender(options) {
                    this.default_title_for_rows = options.default_title_for_rows || "";
                    this.hide_first_column = options.hide_first_column;
                    this.hide_headers = options.hide_headers;
                    this.text_alignment_firstcolumn = options.text_alignment_firstcolumn || "";
                    this.text_alignment_values = options.text_alignment_values || "";
                    this.first_column_link = options.first_column_link || "#";
                    this.table_unit_style = options.table_styles.body_unit_height_style +
                        options.table_styles.body_unit_width_style +
                        options.table_styles.body_unit_padding_style +
                        options.table_styles.body_font_style;
                    console.log(this.table_unit_style);
                }
                return BoomRender;
            }());
            exports_1("BoomRender", BoomRender);
            BoomRender.prototype.getDataAsHTML = function (data, sorting_props) {
                var _this = this;
                var getLinkifiedColumn = function (rowName, first_column_link, raw_rowName) {
                    if (first_column_link !== "#") {
                        first_column_link = first_column_link.replace(new RegExp("_row_name_", "g"), BoomUtils_1.getActualNameWithoutTokens(raw_rowName).trim());
                        rowName = "<a href=\"" + first_column_link + "\" target=\"_blank\">" + rowName + "</a>";
                    }
                    return rowName;
                };
                var output = {
                    body: ""
                };
                if (sorting_props && sorting_props.col_index !== undefined) {
                    if (sorting_props.col_index > -1) {
                        var sortFunction_1 = function (a, b, sortMethod) {
                            if (sortMethod === "asc") {
                                return a[sorting_props.col_index].value - b[sorting_props.col_index].value;
                            }
                            else {
                                return b[sorting_props.col_index].value - a[sorting_props.col_index].value;
                            }
                        };
                        data.row_col_cells = data.row_col_cells
                            .filter(function (a) { return !isNaN(a[sorting_props.col_index].value); })
                            .concat(data.row_col_cells.filter(function (a) { return isNaN(a[sorting_props.col_index].value); }))
                            .sort(function (a, b) { return sortFunction_1(a, b, sorting_props.direction); });
                    }
                    else if (sorting_props.col_index === -1) {
                        var sortFunction_2 = function (a, b, sortMethod) {
                            return BoomUtils_1.boomSortFunc(a[0].row_name, b[0].row_name, sortMethod);
                        };
                        data.row_col_cells = data.row_col_cells.sort(function (a, b) { return sortFunction_2(a, b, sorting_props.direction); });
                    }
                }
                lodash_1.default.each(data.row_col_cells, function (o) {
                    if (o.map(function (item) { return item.hidden.toString(); }).indexOf("false") > -1) {
                        output.body += "<tr>";
                        if (_this.hide_first_column !== true) {
                            var raw_rowName = (lodash_1.default.first(o.map(function (item) { return item.row_name_raw; })));
                            output.body += "\n                    <td style=\"" + _this.table_unit_style + ";text-align:" + _this.text_alignment_firstcolumn + "\">\n                        " + getLinkifiedColumn(lodash_1.default.first(o.map(function (item) { return item.row_name; })), String(_this.first_column_link), raw_rowName) + "\n                    </td>";
                        }
                        lodash_1.default.each(o, function (item) {
                            if (sorting_props.hidden_cols.indexOf(item.col_name) === -1) {
                                if (item.display_value === undefined) {
                                    item.display_value = "-";
                                }
                                var item_style = _this.table_unit_style + ";background-color:" + item.color_bg + ";color:" + item.color_text + ";text-align:" + _this.text_alignment_values;
                                var item_display = (item.link === "#") ? item.display_value
                                    : "<a href=\"" + item.link + "\" target=\"_blank\" style=\"color:" + item.color_text + "\">" + item.display_value + "</a>";
                                var tooltip = (!item.tooltip || item.tooltip === "-") ? undefined
                                    : " data-toggle=\"tooltip\" data-html=\"true\" data-placement=\"top\" title=\"" + item.tooltip.replace(/\"/g, '&#34;') + "\" style=\"display:block;width:100%;height:100%;\"";
                                output.body += "\n                      <td style=\"" + item_style + "\">\n                          " + (tooltip ? "<span " + tooltip + ">" : "") + "\n                              " + (item_display ? "" + item_display : "") + "\n                          " + (tooltip ? "</span>" : "") + "\n                      </td>\n                  ";
                            }
                        });
                        output.body += "</tr>";
                    }
                });
                return output;
            };
            BoomRender.prototype.getDataAsDebugHTML = function (data) {
                var debugdata = "";
                debugdata = lodash_1.default.map(data, function (d) {
                    return "\n        <tr>\n            <td style=\"padding:4px;text-align:left;width:30%; title=\"Series Name\" >" + d.seriesName + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Matching Pattern Name\" >" + (d.pattern.name || d.pattern.pattern || "Default") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Value : " + String(d.value_formatted || "null") + " / Raw : " + String(d.value || "null") + " / Stat : " + d.pattern.valueName + "\">" + d.display_value + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Row name\" >" + d.row_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Col name\" >" + d.col_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Thresholds\" >" + d.thresholds.join(",") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"BG Color\" >" + d.color_bg + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Text Color\" >" + d.color_text + "</td>\n        </tr>\n        ";
                }).join("");
                return debugdata;
            };
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbVJlbmRlci5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tUmVuZGVyLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBS0E7Z0JBVUUsb0JBQVksT0FBOEI7b0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO29CQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO29CQUNuRCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7b0JBQ3pDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxPQUFPLENBQUMsMEJBQTBCLElBQUksRUFBRSxDQUFDO29CQUMzRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQztvQkFDakUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUM7b0JBQzFELElBQUksQ0FBQyxnQkFBZ0IsR0FBSSxPQUFPLENBQUMsWUFBWSxDQUFDLHNCQUFzQjt3QkFDM0MsT0FBTyxDQUFDLFlBQVksQ0FBQyxxQkFBcUI7d0JBQzFDLE9BQU8sQ0FBQyxZQUFZLENBQUMsdUJBQXVCO3dCQUM1QyxPQUFPLENBQUMsWUFBWSxDQUFDLGVBQWUsQ0FBQztvQkFFOUQsT0FBTyxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsZ0JBQWdCLENBQUMsQ0FBQztnQkFDckMsQ0FBQztnQkFDSCxpQkFBQztZQUFELENBQUMsQUF4QkQsSUF3QkM7O1lBQ0QsVUFBVSxDQUFDLFNBQVMsQ0FBQyxhQUFhLEdBQUcsVUFBVSxJQUFnQixFQUFFLGFBQWE7Z0JBQXpDLGlCQXFFcEM7Z0JBcEVDLElBQUksa0JBQWtCLEdBQUcsVUFBVSxPQUFlLEVBQUUsaUJBQXlCLEVBQUUsV0FBbUI7b0JBQ2hHLElBQUksaUJBQWlCLEtBQUssR0FBRyxFQUFFO3dCQUM3QixpQkFBaUIsR0FBRyxpQkFBaUIsQ0FBQyxPQUFPLENBQUMsSUFBSSxNQUFNLENBQUMsWUFBWSxFQUFFLEdBQUcsQ0FBQyxFQUFFLHNDQUEwQixDQUFDLFdBQVcsQ0FBQyxDQUFDLElBQUksRUFBRSxDQUFDLENBQUM7d0JBQzdILE9BQU8sR0FBRyxlQUFZLGlCQUFpQiw2QkFBcUIsT0FBTyxTQUFNLENBQUM7cUJBQzNFO29CQUNELE9BQU8sT0FBTyxDQUFDO2dCQUNqQixDQUFDLENBQUM7Z0JBQ0YsSUFBSSxNQUFNLEdBQWM7b0JBQ3RCLElBQUksRUFBRSxFQUFFO2lCQUNULENBQUM7Z0JBQ0YsSUFBSSxhQUFhLElBQUksYUFBYSxDQUFDLFNBQVMsS0FBSyxTQUFTLEVBQUU7b0JBQzFELElBQUksYUFBYSxDQUFDLFNBQVMsR0FBRyxDQUFDLENBQUMsRUFBQzt3QkFDL0IsSUFBSSxjQUFZLEdBQUcsVUFBQyxDQUFDLEVBQUUsQ0FBQyxFQUFFLFVBQVU7NEJBQ2xDLElBQUksVUFBVSxLQUFLLEtBQUssRUFBRTtnQ0FDeEIsT0FBTyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQzs2QkFDNUU7aUNBQU07Z0NBQ0wsT0FBTyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssR0FBRyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQzs2QkFDNUU7d0JBQ0gsQ0FBQyxDQUFDO3dCQUNGLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWE7NkJBQ3BDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxhQUFhLENBQUMsU0FBUyxDQUFDLENBQUMsS0FBSyxDQUFDLEVBQXhDLENBQXdDLENBQUM7NkJBQ3JELE1BQU0sQ0FBQyxJQUFJLENBQUMsYUFBYSxDQUFDLE1BQU0sQ0FBQyxVQUFBLENBQUMsSUFBSSxPQUFBLEtBQUssQ0FBQyxDQUFDLENBQUMsYUFBYSxDQUFDLFNBQVMsQ0FBQyxDQUFDLEtBQUssQ0FBQyxFQUF2QyxDQUF1QyxDQUFDLENBQUM7NkJBQy9FLElBQUksQ0FBQyxVQUFDLENBQUMsRUFBRSxDQUFDLElBQUssT0FBQSxjQUFZLENBQUMsQ0FBQyxFQUFFLENBQUMsRUFBRSxhQUFhLENBQUMsU0FBUyxDQUFDLEVBQTNDLENBQTJDLENBQUMsQ0FBQztxQkFDaEU7eUJBQU0sSUFBSSxhQUFhLENBQUMsU0FBUyxLQUFLLENBQUMsQ0FBQyxFQUFFO3dCQUN6QyxJQUFJLGNBQVksR0FBRyxVQUFDLENBQXFCLEVBQUUsQ0FBcUIsRUFBRSxVQUFrQjs0QkFDbEYsT0FBTyx3QkFBWSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUMsQ0FBQyxRQUFRLEVBQUUsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsRUFBRSxVQUFVLENBQUMsQ0FBQzt3QkFDaEUsQ0FBQyxDQUFDO3dCQUNGLElBQUksQ0FBQyxhQUFhLEdBQUcsSUFBSSxDQUFDLGFBQWEsQ0FBQyxJQUFJLENBQUMsVUFBQyxDQUFDLEVBQUUsQ0FBQyxJQUFLLE9BQUEsY0FBWSxDQUFDLENBQUMsRUFBRSxDQUFDLEVBQUUsYUFBYSxDQUFDLFNBQVMsQ0FBQyxFQUEzQyxDQUEyQyxDQUFDLENBQUM7cUJBQ3JHO2lCQUNGO2dCQUNELGdCQUFDLENBQUMsSUFBSSxDQUFDLElBQUksQ0FBQyxhQUFhLEVBQUUsVUFBQSxDQUFDO29CQUMxQixJQUFJLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsTUFBTSxDQUFDLFFBQVEsRUFBRSxFQUF0QixDQUFzQixDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFO3dCQUMvRCxNQUFNLENBQUMsSUFBSSxJQUFJLE1BQU0sQ0FBQzt3QkFDdEIsSUFBSSxLQUFJLENBQUMsaUJBQWlCLEtBQUssSUFBSSxFQUFFOzRCQUNuQyxJQUFJLFdBQVcsR0FBRyxDQUFDLGdCQUFDLENBQUMsS0FBSyxDQUFDLENBQUMsQ0FBQyxHQUFHLENBQUMsVUFBQSxJQUFJLElBQUksT0FBQSxJQUFJLENBQUMsWUFBWSxFQUFqQixDQUFpQixDQUFDLENBQUMsQ0FBQyxDQUFDOzRCQUM5RCxNQUFNLENBQUMsSUFBSSxJQUFJLHVDQUNVLEtBQUksQ0FBQyxnQkFBZ0Isb0JBQWUsS0FBSSxDQUFDLDBCQUEwQixxQ0FDMUUsa0JBQWtCLENBQUMsZ0JBQUMsQ0FBQyxLQUFLLENBQUMsQ0FBQyxDQUFDLEdBQUcsQ0FBQyxVQUFBLElBQUksSUFBSSxPQUFBLElBQUksQ0FBQyxRQUFRLEVBQWIsQ0FBYSxDQUFDLENBQUMsRUFBRSxNQUFNLENBQUMsS0FBSSxDQUFDLGlCQUFpQixDQUFDLEVBQUUsV0FBVyxDQUFDLGdDQUN0RyxDQUFDO3lCQUNwQjt3QkFDRCxnQkFBQyxDQUFDLElBQUksQ0FBQyxDQUFDLEVBQUUsVUFBQSxJQUFJOzRCQUNaLElBQUssYUFBYSxDQUFDLFdBQVcsQ0FBQyxPQUFPLENBQUUsSUFBSSxDQUFDLFFBQVEsQ0FBRSxLQUFLLENBQUMsQ0FBQyxFQUFFO2dDQUM5RCxJQUFJLElBQUksQ0FBQyxhQUFhLEtBQUssU0FBUyxFQUFDO29DQUNuQyxJQUFJLENBQUMsYUFBYSxHQUFHLEdBQUcsQ0FBQztpQ0FDMUI7Z0NBQ0QsSUFBSSxVQUFVLEdBQU0sS0FBSSxDQUFDLGdCQUFnQiwwQkFBcUIsSUFBSSxDQUFDLFFBQVEsZUFDekUsSUFBSSxDQUFDLFVBQVUsb0JBQ0EsS0FBSSxDQUFDLHFCQUF1QixDQUFDO2dDQUM5QyxJQUFJLFlBQVksR0FBRyxDQUFDLElBQUksQ0FBQyxJQUFJLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxhQUFhO29DQUN2RCxDQUFDLENBQUMsZUFBWSxJQUFJLENBQUMsSUFBSSwyQ0FBa0MsSUFBSSxDQUFDLFVBQVUsV0FBSyxJQUFJLENBQUMsYUFBYSxTQUFNLENBQUM7Z0NBQzFHLElBQUksT0FBTyxHQUFHLENBQUMsQ0FBQyxJQUFJLENBQUMsT0FBTyxJQUFJLElBQUksQ0FBQyxPQUFPLEtBQUssR0FBRyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVM7b0NBQzdELENBQUMsQ0FBQyxnRkFDQSxJQUFJLENBQUMsT0FBTyxDQUFDLE9BQU8sQ0FBQyxLQUFLLEVBQUUsT0FBTyxDQUFDLHVEQUNXLENBQUM7Z0NBQ3RELE1BQU0sQ0FBQyxJQUFJLElBQUkseUNBQ1UsVUFBVSx3Q0FDakIsT0FBTyxDQUFDLENBQUMsQ0FBQyxXQUFTLE9BQU8sTUFBRyxDQUFDLENBQUMsQ0FBQyxFQUFFLDBDQUM5QixZQUFZLENBQUMsQ0FBQyxDQUFDLEtBQUcsWUFBYyxDQUFDLENBQUMsQ0FBQyxFQUFFLHNDQUN6QyxPQUFPLENBQUMsQ0FBQyxDQUFDLFNBQVMsQ0FBQyxDQUFDLENBQUMsRUFBRSx1REFFakMsQ0FBQzs2QkFDWDt3QkFDSCxDQUFDLENBQUMsQ0FBQzt3QkFDSCxNQUFNLENBQUMsSUFBSSxJQUFJLE9BQU8sQ0FBQztxQkFDeEI7Z0JBQ0gsQ0FBQyxDQUFDLENBQUM7Z0JBRUgsT0FBTyxNQUFNLENBQUM7WUFDaEIsQ0FBQyxDQUFDO1lBQ0YsVUFBVSxDQUFDLFNBQVMsQ0FBQyxrQkFBa0IsR0FBRyxVQUFVLElBQW1CO2dCQUNyRSxJQUFJLFNBQVMsR0FBRyxFQUFFLENBQUM7Z0JBQ25CLFNBQVMsR0FBRyxnQkFBQyxDQUFDLEdBQUcsQ0FBQyxJQUFJLEVBQUUsVUFBQSxDQUFDO29CQUN2QixPQUFPLDJHQUUwRSxDQUFDLENBQUMsVUFBVSxnSEFDRixDQUFDLENBQUMsT0FBTyxDQUFDLElBQUksSUFBSSxDQUFDLENBQUMsT0FBTyxDQUFDLE9BQU8sSUFBSSxTQUFTLCtGQUNoRSxNQUFNLENBQUMsQ0FBQyxDQUFDLGVBQWUsSUFBSSxNQUFNLENBQUMsaUJBQVksTUFBTSxDQUFDLENBQUMsQ0FBQyxLQUFLLElBQUksTUFBTSxDQUFDLGtCQUFhLENBQUMsQ0FBQyxPQUFPLENBQUMsU0FBUyxXQUFLLENBQUMsQ0FBQyxhQUFhLGtHQUN6SCxDQUFDLENBQUMsUUFBUSxrR0FDVixDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsa0dBQ3hCLENBQUMsQ0FBQyxRQUFRLG9HQUNSLENBQUMsQ0FBQyxVQUFVLG1DQUV2RixDQUFDO2dCQUNSLENBQUMsQ0FBQyxDQUFDLElBQUksQ0FBQyxFQUFFLENBQUMsQ0FBQztnQkFDWixPQUFPLFNBQVMsQ0FBQztZQUNuQixDQUFDLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJpbXBvcnQgXyBmcm9tIFwibG9kYXNoXCI7XG5pbXBvcnQgeyBJQm9vbUhUTUwsIElCb29tVGFibGUsIElCb29tUmVuZGVyaW5nT3B0aW9ucywgSUJvb21TZXJpZXMgfSBmcm9tIFwiLi9pbmRleFwiO1xuaW1wb3J0IHsgZ2V0QWN0dWFsTmFtZVdpdGhvdXRUb2tlbnMsIGJvb21Tb3J0RnVuYyB9IGZyb20gXCIuL0Jvb21VdGlsc1wiO1xuaW1wb3J0IHsgSUJvb21DZWxsRGV0YWlscyB9IGZyb20gXCIuL0Jvb20uaW50ZXJmYWNlXCI7XG5cbmV4cG9ydCBjbGFzcyBCb29tUmVuZGVyIHtcbiAgcHVibGljIGRlZmF1bHRfdGl0bGVfZm9yX3Jvd3M6IFN0cmluZztcbiAgcHVibGljIGhpZGVfZmlyc3RfY29sdW1uOiBCb29sZWFuO1xuICBwdWJsaWMgaGlkZV9oZWFkZXJzOiBCb29sZWFuO1xuICBwdWJsaWMgdGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW46IFN0cmluZztcbiAgcHVibGljIHRleHRfYWxpZ25tZW50X3ZhbHVlczogU3RyaW5nO1xuICBwdWJsaWMgZmlyc3RfY29sdW1uX2xpbms6IFN0cmluZztcbiAgcHVibGljIHRhYmxlX3VuaXRfc3R5bGU6IHN0cmluZztcbiAgcHVibGljIGdldERhdGFBc0hUTUw7XG4gIHB1YmxpYyBnZXREYXRhQXNEZWJ1Z0hUTUw7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElCb29tUmVuZGVyaW5nT3B0aW9ucykge1xuICAgIHRoaXMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyA9IG9wdGlvbnMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyB8fCBcIlwiO1xuICAgIHRoaXMuaGlkZV9maXJzdF9jb2x1bW4gPSBvcHRpb25zLmhpZGVfZmlyc3RfY29sdW1uO1xuICAgIHRoaXMuaGlkZV9oZWFkZXJzID0gb3B0aW9ucy5oaWRlX2hlYWRlcnM7XG4gICAgdGhpcy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbiA9IG9wdGlvbnMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW4gfHwgXCJcIjtcbiAgICB0aGlzLnRleHRfYWxpZ25tZW50X3ZhbHVlcyA9IG9wdGlvbnMudGV4dF9hbGlnbm1lbnRfdmFsdWVzIHx8IFwiXCI7XG4gICAgdGhpcy5maXJzdF9jb2x1bW5fbGluayA9IG9wdGlvbnMuZmlyc3RfY29sdW1uX2xpbmsgfHwgXCIjXCI7XG4gICAgdGhpcy50YWJsZV91bml0X3N0eWxlICA9IG9wdGlvbnMudGFibGVfc3R5bGVzLmJvZHlfdW5pdF9oZWlnaHRfc3R5bGUgK1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICBvcHRpb25zLnRhYmxlX3N0eWxlcy5ib2R5X3VuaXRfd2lkdGhfc3R5bGUgICtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgb3B0aW9ucy50YWJsZV9zdHlsZXMuYm9keV91bml0X3BhZGRpbmdfc3R5bGUrXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgIG9wdGlvbnMudGFibGVfc3R5bGVzLmJvZHlfZm9udF9zdHlsZTtcblxuICAgIGNvbnNvbGUubG9nKHRoaXMudGFibGVfdW5pdF9zdHlsZSk7XG4gIH1cbn1cbkJvb21SZW5kZXIucHJvdG90eXBlLmdldERhdGFBc0hUTUwgPSBmdW5jdGlvbiAoZGF0YTogSUJvb21UYWJsZSwgc29ydGluZ19wcm9wcyk6IElCb29tSFRNTCB7XG4gIGxldCBnZXRMaW5raWZpZWRDb2x1bW4gPSBmdW5jdGlvbiAocm93TmFtZTogc3RyaW5nLCBmaXJzdF9jb2x1bW5fbGluazogc3RyaW5nLCByYXdfcm93TmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoZmlyc3RfY29sdW1uX2xpbmsgIT09IFwiI1wiKSB7XG4gICAgICBmaXJzdF9jb2x1bW5fbGluayA9IGZpcnN0X2NvbHVtbl9saW5rLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCBnZXRBY3R1YWxOYW1lV2l0aG91dFRva2VucyhyYXdfcm93TmFtZSkudHJpbSgpKTtcbiAgICAgIHJvd05hbWUgPSBgPGEgaHJlZj1cIiR7Zmlyc3RfY29sdW1uX2xpbmt9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtyb3dOYW1lfTwvYT5gO1xuICAgIH1cbiAgICByZXR1cm4gcm93TmFtZTtcbiAgfTtcbiAgbGV0IG91dHB1dDogSUJvb21IVE1MID0ge1xuICAgIGJvZHk6IFwiXCJcbiAgfTtcbiAgaWYgKHNvcnRpbmdfcHJvcHMgJiYgc29ydGluZ19wcm9wcy5jb2xfaW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChzb3J0aW5nX3Byb3BzLmNvbF9pbmRleCA+IC0xKXtcbiAgICAgIGxldCBzb3J0RnVuY3Rpb24gPSAoYSwgYiwgc29ydE1ldGhvZCkgPT4ge1xuICAgICAgICBpZiAoc29ydE1ldGhvZCA9PT0gXCJhc2NcIikge1xuICAgICAgICAgIHJldHVybiBhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSAtIGJbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBiW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSAtIGFbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZGF0YS5yb3dfY29sX2NlbGxzID0gZGF0YS5yb3dfY29sX2NlbGxzXG4gICAgICAgIC5maWx0ZXIoYSA9PiAhaXNOYU4oYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUpKVxuICAgICAgICAuY29uY2F0KGRhdGEucm93X2NvbF9jZWxscy5maWx0ZXIoYSA9PiBpc05hTihhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSkpKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gc29ydEZ1bmN0aW9uKGEsIGIsIHNvcnRpbmdfcHJvcHMuZGlyZWN0aW9uKSk7XG4gICAgfSBlbHNlIGlmIChzb3J0aW5nX3Byb3BzLmNvbF9pbmRleCA9PT0gLTEpIHtcbiAgICAgIGxldCBzb3J0RnVuY3Rpb24gPSAoYTogSUJvb21DZWxsRGV0YWlsc1tdLCBiOiBJQm9vbUNlbGxEZXRhaWxzW10sIHNvcnRNZXRob2Q6IHN0cmluZykgPT4ge1xuICAgICAgICByZXR1cm4gYm9vbVNvcnRGdW5jKGFbMF0ucm93X25hbWUsIGJbMF0ucm93X25hbWUsIHNvcnRNZXRob2QpO1xuICAgICAgfTtcbiAgICAgIGRhdGEucm93X2NvbF9jZWxscyA9IGRhdGEucm93X2NvbF9jZWxscy5zb3J0KChhLCBiKSA9PiBzb3J0RnVuY3Rpb24oYSwgYiwgc29ydGluZ19wcm9wcy5kaXJlY3Rpb24pKTtcbiAgICB9XG4gIH1cbiAgXy5lYWNoKGRhdGEucm93X2NvbF9jZWxscywgbyA9PiB7XG4gICAgaWYgKG8ubWFwKGl0ZW0gPT4gaXRlbS5oaWRkZW4udG9TdHJpbmcoKSkuaW5kZXhPZihcImZhbHNlXCIpID4gLTEpIHtcbiAgICAgIG91dHB1dC5ib2R5ICs9IFwiPHRyPlwiO1xuICAgICAgaWYgKHRoaXMuaGlkZV9maXJzdF9jb2x1bW4gIT09IHRydWUpIHtcbiAgICAgICAgbGV0IHJhd19yb3dOYW1lID0gKF8uZmlyc3Qoby5tYXAoaXRlbSA9PiBpdGVtLnJvd19uYW1lX3JhdykpKTtcbiAgICAgICAgb3V0cHV0LmJvZHkgKz0gYFxuICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9XCIke3RoaXMudGFibGVfdW5pdF9zdHlsZX07dGV4dC1hbGlnbjoke3RoaXMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW59XCI+XG4gICAgICAgICAgICAgICAgICAgICAgICAke2dldExpbmtpZmllZENvbHVtbihfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZSkpLCBTdHJpbmcodGhpcy5maXJzdF9jb2x1bW5fbGluayksIHJhd19yb3dOYW1lKX1cbiAgICAgICAgICAgICAgICAgICAgPC90ZD5gO1xuICAgICAgfVxuICAgICAgXy5lYWNoKG8sIGl0ZW0gPT4ge1xuICAgICAgICBpZiAoIHNvcnRpbmdfcHJvcHMuaGlkZGVuX2NvbHMuaW5kZXhPZiggaXRlbS5jb2xfbmFtZSApID09PSAtMSApe1xuICAgICAgICAgIGlmIChpdGVtLmRpc3BsYXlfdmFsdWUgPT09IHVuZGVmaW5lZCl7XG4gICAgICAgICAgICBpdGVtLmRpc3BsYXlfdmFsdWUgPSBcIi1cIjtcbiAgICAgICAgICB9XG4gICAgICAgICAgbGV0IGl0ZW1fc3R5bGUgPSBgJHt0aGlzLnRhYmxlX3VuaXRfc3R5bGV9O2JhY2tncm91bmQtY29sb3I6JHtpdGVtLmNvbG9yX2JnfTtjb2xvcjoke1xuICAgICAgICAgICAgaXRlbS5jb2xvcl90ZXh0XG4gICAgICAgICAgICB9O3RleHQtYWxpZ246JHt0aGlzLnRleHRfYWxpZ25tZW50X3ZhbHVlc31gO1xuICAgICAgICAgIGxldCBpdGVtX2Rpc3BsYXkgPSAoaXRlbS5saW5rID09PSBcIiNcIikgPyBpdGVtLmRpc3BsYXlfdmFsdWVcbiAgICAgICAgICAgICAgOiBgPGEgaHJlZj1cIiR7aXRlbS5saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiIHN0eWxlPVwiY29sb3I6JHtpdGVtLmNvbG9yX3RleHR9XCI+JHtpdGVtLmRpc3BsYXlfdmFsdWV9PC9hPmA7XG4gICAgICAgICAgbGV0IHRvb2x0aXAgPSAoIWl0ZW0udG9vbHRpcCB8fCBpdGVtLnRvb2x0aXAgPT09IFwiLVwiKSA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICA6IGAgZGF0YS10b2dnbGU9XCJ0b29sdGlwXCIgZGF0YS1odG1sPVwidHJ1ZVwiIGRhdGEtcGxhY2VtZW50PVwidG9wXCIgdGl0bGU9XCIke1xuICAgICAgICAgICAgICAgIGl0ZW0udG9vbHRpcC5yZXBsYWNlKC9cXFwiL2csICcmIzM0OycpXG4gICAgICAgICAgICAgIH1cIiBzdHlsZT1cImRpc3BsYXk6YmxvY2s7d2lkdGg6MTAwJTtoZWlnaHQ6MTAwJTtcImA7XG4gICAgICAgICAgb3V0cHV0LmJvZHkgKz0gYFxuICAgICAgICAgICAgICAgICAgICAgIDx0ZCBzdHlsZT1cIiR7aXRlbV9zdHlsZX1cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDxzcGFuICR7dG9vbHRpcH0+YCA6IFwiXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW1fZGlzcGxheSA/IGAke2l0ZW1fZGlzcGxheX1gIDogXCJcIn1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDwvc3Bhbj5gIDogXCJcIn1cbiAgICAgICAgICAgICAgICAgICAgICA8L3RkPlxuICAgICAgICAgICAgICAgICAgYDtcbiAgICAgICAgfVxuICAgICAgfSk7XG4gICAgICBvdXRwdXQuYm9keSArPSBcIjwvdHI+XCI7XG4gICAgfVxuICB9KTtcbiAgLy8gY29uc29sZS5sb2coIFwiaHRtbDogXCIsIG91dHB1dC5ib2R5ICk7XG4gIHJldHVybiBvdXRwdXQ7XG59O1xuQm9vbVJlbmRlci5wcm90b3R5cGUuZ2V0RGF0YUFzRGVidWdIVE1MID0gZnVuY3Rpb24gKGRhdGE6IElCb29tU2VyaWVzW10pOiBzdHJpbmcge1xuICBsZXQgZGVidWdkYXRhID0gYGA7XG4gIGRlYnVnZGF0YSA9IF8ubWFwKGRhdGEsIGQgPT4ge1xuICAgIHJldHVybiBgXG4gICAgICAgIDx0cj5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDozMCU7IHRpdGxlPVwiU2VyaWVzIE5hbWVcIiA+JHtkLnNlcmllc05hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiTWF0Y2hpbmcgUGF0dGVybiBOYW1lXCIgPiR7ZC5wYXR0ZXJuLm5hbWUgfHwgZC5wYXR0ZXJuLnBhdHRlcm4gfHwgXCJEZWZhdWx0XCJ9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVmFsdWUgOiAke1N0cmluZyhkLnZhbHVlX2Zvcm1hdHRlZCB8fCBcIm51bGxcIil9IC8gUmF3IDogJHtTdHJpbmcoZC52YWx1ZSB8fCBcIm51bGxcIil9IC8gU3RhdCA6ICR7ZC5wYXR0ZXJuLnZhbHVlTmFtZX1cIj4ke2QuZGlzcGxheV92YWx1ZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJSb3cgbmFtZVwiID4ke2Qucm93X25hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiQ29sIG5hbWVcIiA+JHtkLmNvbF9uYW1lfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlRocmVzaG9sZHNcIiA+JHtkLnRocmVzaG9sZHMuam9pbihcIixcIil9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiQkcgQ29sb3JcIiA+JHtkLmNvbG9yX2JnfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlRleHQgQ29sb3JcIiA+JHtkLmNvbG9yX3RleHR9PC90ZD5cbiAgICAgICAgPC90cj5cbiAgICAgICAgYDtcbiAgfSkuam9pbihgYCk7XG4gIHJldHVybiBkZWJ1Z2RhdGE7XG59O1xuIl19
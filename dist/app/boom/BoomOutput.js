System.register(["lodash", "./BoomUtils"], function (exports_1, context_1) {
    "use strict";
    var lodash_1, BoomUtils_1, BoomOutput;
    var __moduleName = context_1 && context_1.id;
    return {
        setters: [
            function (lodash_1_1) {
                lodash_1 = lodash_1_1;
            },
            function (BoomUtils_1_1) {
                BoomUtils_1 = BoomUtils_1_1;
            }
        ],
        execute: function () {
            BoomOutput = (function () {
                function BoomOutput(options) {
                    this.default_title_for_rows = options.default_title_for_rows || "";
                    this.hide_first_column = options.hide_first_column;
                    this.hide_headers = options.hide_headers;
                    this.text_alignment_firstcolumn = options.text_alignment_firstcolumn || "";
                    this.text_alignment_values = options.text_alignment_values || "";
                    this.first_column_link = options.first_column_link || "#";
                    this.table_unit_height_str = options.table_unit_height > -1 ? 'height:' + options.table_unit_height + 'px' : '';
                    this.table_unit_width_str = options.table_unit_width > -1 ? 'width:' + options.table_unit_width + 'px' : '';
                    this.table_unit_padding_str = options.table_unit_padding > -1 ? 'padding:' + options.table_unit_padding + 'px' : ';padding:4px';
                    this.unit_style_ext = this.table_unit_padding_str + ";" + this.table_unit_width_str + ";" + this.table_unit_height_str;
                    console.log(this.unit_style_ext);
                }
                return BoomOutput;
            }());
            exports_1("BoomOutput", BoomOutput);
            BoomOutput.prototype.getDataAsHTML = function (data, sorting_props) {
                var _this = this;
                var getLinkifiedColumn = function (rowName, first_column_link, raw_rowName) {
                    if (first_column_link !== "#") {
                        first_column_link = first_column_link.replace(new RegExp("_row_name_", "g"), BoomUtils_1.getActualNameWithoutTokens(raw_rowName).trim());
                        rowName = "<a href=\"" + first_column_link + "\" target=\"_blank\">" + rowName + "</a>";
                    }
                    return rowName;
                };
                var output = {
                    body: ""
                };
                if (sorting_props && sorting_props.col_index !== undefined) {
                    if (sorting_props.col_index > -1) {
                        var sortFunction_1 = function (a, b, sortMethod) {
                            if (sortMethod === "asc") {
                                return a[sorting_props.col_index].value - b[sorting_props.col_index].value;
                            }
                            else {
                                return b[sorting_props.col_index].value - a[sorting_props.col_index].value;
                            }
                        };
                        data.row_col_cells = data.row_col_cells
                            .filter(function (a) { return !isNaN(a[sorting_props.col_index].value); })
                            .concat(data.row_col_cells.filter(function (a) { return isNaN(a[sorting_props.col_index].value); }))
                            .sort(function (a, b) { return sortFunction_1(a, b, sorting_props.direction); });
                    }
                    else if (sorting_props.col_index === -1) {
                        var sortFunction_2 = function (a, b, sortMethod) {
                            var na = Number(a[0].row_name);
                            var nb = Number(b[0].row_name);
                            var iv = sortMethod === "asc" ? 1 : -1;
                            if (isNaN(na) && isNaN(nb)) {
                                return a[0].row_name > b[0].row_name ? iv : -iv;
                            }
                            else if (isNaN(na)) {
                                return -iv;
                            }
                            else if (isNaN(nb)) {
                                return iv;
                            }
                            else {
                                return iv * (na - nb);
                            }
                        };
                        data.row_col_cells = data.row_col_cells.sort(function (a, b) { return sortFunction_2(a, b, sorting_props.direction); });
                    }
                }
                lodash_1.default.each(data.row_col_cells, function (o) {
                    if (o.map(function (item) { return item.hidden.toString(); }).indexOf("false") > -1) {
                        output.body += "<tr>";
                        if (_this.hide_first_column !== true) {
                            var raw_rowName = (lodash_1.default.first(o.map(function (item) { return item.row_name_raw; })));
                            output.body += "\n                    <td style=\"" + _this.unit_style_ext + ";text-align:" + _this.text_alignment_firstcolumn + "\">\n                        " + getLinkifiedColumn(lodash_1.default.first(o.map(function (item) { return item.row_name; })), String(_this.first_column_link), raw_rowName) + "\n                    </td>";
                        }
                        lodash_1.default.each(o, function (item) {
                            if (sorting_props.hidden_cols.indexOf(item.col_name) === -1) {
                                if (item.display_value === undefined) {
                                    item.display_value = "-";
                                }
                                var item_style = _this.unit_style_ext + ";background-color:" + item.color_bg + ";color:" + item.color_text + ";text-align:" + _this.text_alignment_values;
                                var item_display = (item.link === "#") ? item.display_value
                                    : "<a href=\"" + item.link + "\" target=\"_blank\" style=\"color:" + item.color_text + "\">" + item.display_value + "</a>";
                                var tooltip = (!item.tooltip || item.tooltip === "-") ? undefined
                                    : " data-toggle=\"tooltip\" data-html=\"true\" data-placement=\"top\" title=\"" + item.tooltip.replace(/\"/g, '&#34;') + "\" ";
                                output.body += "\n                      <td style=\"" + item_style + " " + tooltip + "\">\n                          " + (tooltip ? "<span " + tooltip + ">" : "") + "\n                              " + (item_display ? "" + item_display : "&nbsp") + "\n                          " + (tooltip ? "</span>" : "") + "\n                      </td>\n                  ";
                            }
                        });
                        output.body += "</tr>";
                    }
                });
                return output;
            };
            BoomOutput.prototype.getDataAsDebugHTML = function (data) {
                var debugdata = "";
                debugdata = lodash_1.default.map(data, function (d) {
                    return "\n        <tr>\n            <td style=\"padding:4px;text-align:left;width:30%; title=\"Series Name\" >" + d.seriesName + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Matching Pattern Name\" >" + (d.pattern.name || d.pattern.pattern || "Default") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Value : " + String(d.value_formatted || "null") + " / Raw : " + String(d.value || "null") + " / Stat : " + d.pattern.valueName + "\">" + d.display_value + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Row name\" >" + d.row_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Col name\" >" + d.col_name + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Thresholds\" >" + d.thresholds.join(",") + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"BG Color\" >" + d.color_bg + "</td>\n            <td style=\"padding:4px;text-align:left;width:10%; title=\"Text Color\" >" + d.color_text + "</td>\n        </tr>\n        ";
                }).join("");
                return debugdata;
            };
        }
    };
});
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiQm9vbU91dHB1dC5qcyIsInNvdXJjZVJvb3QiOiIiLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9hcHAvYm9vbS9Cb29tT3V0cHV0LnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7Ozs7Ozs7Ozs7Ozs7O1lBS0E7Z0JBYUUsb0JBQVksT0FBOEI7b0JBQ3hDLElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsc0JBQXNCLElBQUksRUFBRSxDQUFDO29CQUNuRSxJQUFJLENBQUMsaUJBQWlCLEdBQUcsT0FBTyxDQUFDLGlCQUFpQixDQUFDO29CQUNuRCxJQUFJLENBQUMsWUFBWSxHQUFHLE9BQU8sQ0FBQyxZQUFZLENBQUM7b0JBQ3pDLElBQUksQ0FBQywwQkFBMEIsR0FBRyxPQUFPLENBQUMsMEJBQTBCLElBQUksRUFBRSxDQUFDO29CQUMzRSxJQUFJLENBQUMscUJBQXFCLEdBQUcsT0FBTyxDQUFDLHFCQUFxQixJQUFJLEVBQUUsQ0FBQztvQkFDakUsSUFBSSxDQUFDLGlCQUFpQixHQUFHLE9BQU8sQ0FBQyxpQkFBaUIsSUFBSSxHQUFHLENBQUM7b0JBQzFELElBQUksQ0FBQyxxQkFBcUIsR0FBSSxPQUFPLENBQUMsaUJBQWlCLEdBQUksQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFNBQVMsR0FBSSxPQUFPLENBQUMsaUJBQWlCLEdBQUksSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQ3BILElBQUksQ0FBQyxvQkFBb0IsR0FBSyxPQUFPLENBQUMsZ0JBQWdCLEdBQUssQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFFBQVEsR0FBSyxPQUFPLENBQUMsZ0JBQWdCLEdBQUssSUFBSSxDQUFDLENBQUMsQ0FBQyxFQUFFLENBQUM7b0JBQ3BILElBQUksQ0FBQyxzQkFBc0IsR0FBRyxPQUFPLENBQUMsa0JBQWtCLEdBQUcsQ0FBQyxDQUFDLENBQUMsQ0FBQyxDQUFDLFVBQVUsR0FBRyxPQUFPLENBQUMsa0JBQWtCLEdBQUcsSUFBSSxDQUFDLENB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QUFDLFNBQVMsV0FBSyxDQUFDLENBQUMsYUFBYSxrR0FDekgsQ0FBQyxDQUFDLFFBQVEsa0dBQ1YsQ0FBQyxDQUFDLFFBQVEsb0dBQ1IsQ0FBQyxDQUFDLFVBQVUsQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLGtHQUN4QixDQUFDLENBQUMsUUFBUSxvR0FDUixDQUFDLENBQUMsVUFBVSxtQ0FFdkYsQ0FBQztnQkFDUixDQUFDLENBQUMsQ0FBQyxJQUFJLENBQUMsRUFBRSxDQUFDLENBQUM7Z0JBQ1osT0FBTyxTQUFTLENBQUM7WUFDbkIsQ0FBQyxDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IF8gZnJvbSBcImxvZGFzaFwiO1xuaW1wb3J0IHsgSUJvb21IVE1MLCBJQm9vbVRhYmxlLCBJQm9vbVJlbmRlcmluZ09wdGlvbnMsIElCb29tU2VyaWVzIH0gZnJvbSBcIi4vaW5kZXhcIjtcbmltcG9ydCB7IGdldEFjdHVhbE5hbWVXaXRob3V0VG9rZW5zIH0gZnJvbSBcIi4vQm9vbVV0aWxzXCI7XG5pbXBvcnQgeyBJQm9vbUNlbGxEZXRhaWxzIH0gZnJvbSBcIi4vQm9vbS5pbnRlcmZhY2VcIjtcblxuZXhwb3J0IGNsYXNzIEJvb21PdXRwdXQge1xuICBwdWJsaWMgZGVmYXVsdF90aXRsZV9mb3Jfcm93czogU3RyaW5nO1xuICBwdWJsaWMgaGlkZV9maXJzdF9jb2x1bW46IEJvb2xlYW47XG4gIHB1YmxpYyBoaWRlX2hlYWRlcnM6IEJvb2xlYW47XG4gIHB1YmxpYyB0ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbjogU3RyaW5nO1xuICBwdWJsaWMgdGV4dF9hbGlnbm1lbnRfdmFsdWVzOiBTdHJpbmc7XG4gIHB1YmxpYyBmaXJzdF9jb2x1bW5fbGluazogU3RyaW5nO1xuICBwdWJsaWMgdGFibGVfdW5pdF9oZWlnaHRfc3RyOiBzdHJpbmc7XG4gIHB1YmxpYyB0YWJsZV91bml0X3dpZHRoX3N0cjogc3RyaW5nO1xuICBwdWJsaWMgdGFibGVfdW5pdF9wYWRkaW5nX3N0cjogc3RyaW5nO1xuICBwdWJsaWMgdW5pdF9zdHlsZV9leHQ6IHN0cmluZztcbiAgcHVibGljIGdldERhdGFBc0hUTUw7XG4gIHB1YmxpYyBnZXREYXRhQXNEZWJ1Z0hUTUw7XG4gIGNvbnN0cnVjdG9yKG9wdGlvbnM6IElCb29tUmVuZGVyaW5nT3B0aW9ucykge1xuICAgIHRoaXMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyA9IG9wdGlvbnMuZGVmYXVsdF90aXRsZV9mb3Jfcm93cyB8fCBcIlwiO1xuICAgIHRoaXMuaGlkZV9maXJzdF9jb2x1bW4gPSBvcHRpb25zLmhpZGVfZmlyc3RfY29sdW1uO1xuICAgIHRoaXMuaGlkZV9oZWFkZXJzID0gb3B0aW9ucy5oaWRlX2hlYWRlcnM7XG4gICAgdGhpcy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbiA9IG9wdGlvbnMudGV4dF9hbGlnbm1lbnRfZmlyc3Rjb2x1bW4gfHwgXCJcIjtcbiAgICB0aGlzLnRleHRfYWxpZ25tZW50X3ZhbHVlcyA9IG9wdGlvbnMudGV4dF9hbGlnbm1lbnRfdmFsdWVzIHx8IFwiXCI7XG4gICAgdGhpcy5maXJzdF9jb2x1bW5fbGluayA9IG9wdGlvbnMuZmlyc3RfY29sdW1uX2xpbmsgfHwgXCIjXCI7XG4gICAgdGhpcy50YWJsZV91bml0X2hlaWdodF9zdHIgID0gb3B0aW9ucy50YWJsZV91bml0X2hlaWdodCAgPiAtMSA/ICdoZWlnaHQ6JyAgKyBvcHRpb25zLnRhYmxlX3VuaXRfaGVpZ2h0ICArICdweCcgOiAnJztcbiAgICB0aGlzLnRhYmxlX3VuaXRfd2lkdGhfc3RyICAgPSBvcHRpb25zLnRhYmxlX3VuaXRfd2lkdGggICA+IC0xID8gJ3dpZHRoOicgICArIG9wdGlvbnMudGFibGVfdW5pdF93aWR0aCAgICsgJ3B4JyA6ICcnO1xuICAgIHRoaXMudGFibGVfdW5pdF9wYWRkaW5nX3N0ciA9IG9wdGlvbnMudGFibGVfdW5pdF9wYWRkaW5nID4gLTEgPyAncGFkZGluZzonICsgb3B0aW9ucy50YWJsZV91bml0X3BhZGRpbmcgKyAncHgnIDogJztwYWRkaW5nOjRweCc7XG4gICAgdGhpcy51bml0X3N0eWxlX2V4dCA9IHRoaXMudGFibGVfdW5pdF9wYWRkaW5nX3N0ciArIFwiO1wiICsgdGhpcy50YWJsZV91bml0X3dpZHRoX3N0ciArIFwiO1wiICsgdGhpcy50YWJsZV91bml0X2hlaWdodF9zdHI7XG4gICAgY29uc29sZS5sb2codGhpcy51bml0X3N0eWxlX2V4dCk7XG4gIH1cbn1cbkJvb21PdXRwdXQucHJvdG90eXBlLmdldERhdGFBc0hUTUwgPSBmdW5jdGlvbiAoZGF0YTogSUJvb21UYWJsZSwgc29ydGluZ19wcm9wcyk6IElCb29tSFRNTCB7XG4gIGxldCBnZXRMaW5raWZpZWRDb2x1bW4gPSBmdW5jdGlvbiAocm93TmFtZTogc3RyaW5nLCBmaXJzdF9jb2x1bW5fbGluazogc3RyaW5nLCByYXdfcm93TmFtZTogc3RyaW5nKTogc3RyaW5nIHtcbiAgICBpZiAoZmlyc3RfY29sdW1uX2xpbmsgIT09IFwiI1wiKSB7XG4gICAgICBmaXJzdF9jb2x1bW5fbGluayA9IGZpcnN0X2NvbHVtbl9saW5rLnJlcGxhY2UobmV3IFJlZ0V4cChcIl9yb3dfbmFtZV9cIiwgXCJnXCIpLCBnZXRBY3R1YWxOYW1lV2l0aG91dFRva2VucyhyYXdfcm93TmFtZSkudHJpbSgpKTtcbiAgICAgIHJvd05hbWUgPSBgPGEgaHJlZj1cIiR7Zmlyc3RfY29sdW1uX2xpbmt9XCIgdGFyZ2V0PVwiX2JsYW5rXCI+JHtyb3dOYW1lfTwvYT5gO1xuICAgIH1cbiAgICByZXR1cm4gcm93TmFtZTtcbiAgfTtcbiAgbGV0IG91dHB1dDogSUJvb21IVE1MID0ge1xuICAgIGJvZHk6IFwiXCJcbiAgfTtcbiAgaWYgKHNvcnRpbmdfcHJvcHMgJiYgc29ydGluZ19wcm9wcy5jb2xfaW5kZXggIT09IHVuZGVmaW5lZCkge1xuICAgIGlmIChzb3J0aW5nX3Byb3BzLmNvbF9pbmRleCA+IC0xKXtcbiAgICAgIGxldCBzb3J0RnVuY3Rpb24gPSAoYSwgYiwgc29ydE1ldGhvZCkgPT4ge1xuICAgICAgICBpZiAoc29ydE1ldGhvZCA9PT0gXCJhc2NcIikge1xuICAgICAgICAgIHJldHVybiBhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSAtIGJbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlO1xuICAgICAgICB9IGVsc2Uge1xuICAgICAgICAgIHJldHVybiBiW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSAtIGFbc29ydGluZ19wcm9wcy5jb2xfaW5kZXhdLnZhbHVlO1xuICAgICAgICB9XG4gICAgICB9O1xuICAgICAgZGF0YS5yb3dfY29sX2NlbGxzID0gZGF0YS5yb3dfY29sX2NlbGxzXG4gICAgICAgIC5maWx0ZXIoYSA9PiAhaXNOYU4oYVtzb3J0aW5nX3Byb3BzLmNvbF9pbmRleF0udmFsdWUpKVxuICAgICAgICAuY29uY2F0KGRhdGEucm93X2NvbF9jZWxscy5maWx0ZXIoYSA9PiBpc05hTihhW3NvcnRpbmdfcHJvcHMuY29sX2luZGV4XS52YWx1ZSkpKVxuICAgICAgICAuc29ydCgoYSwgYikgPT4gc29ydEZ1bmN0aW9uKGEsIGIsIHNvcnRpbmdfcHJvcHMuZGlyZWN0aW9uKSk7XG4gICAgfSBlbHNlIGlmIChzb3J0aW5nX3Byb3BzLmNvbF9pbmRleCA9PT0gLTEpIHtcbiAgICAgIGxldCBzb3J0RnVuY3Rpb24gPSAoYTogSUJvb21DZWxsRGV0YWlsc1tdLCBiOiBJQm9vbUNlbGxEZXRhaWxzW10sIHNvcnRNZXRob2QpID0+IHtcbiAgICAgICAgbGV0IG5hID0gTnVtYmVyKGFbMF0ucm93X25hbWUpO1xuICAgICAgICBsZXQgbmIgPSBOdW1iZXIoYlswXS5yb3dfbmFtZSk7XG4gICAgICAgIGxldCBpdiA9IHNvcnRNZXRob2QgPT09IFwiYXNjXCIgPyAxIDogLTE7XG4gICAgICAgIGlmIChpc05hTihuYSkgJiYgaXNOYU4obmIpKXtcbiAgICAgICAgICByZXR1cm4gYVswXS5yb3dfbmFtZSA+IGJbMF0ucm93X25hbWUgPyBpdiA6IC1pdjtcbiAgICAgICAgfSBlbHNlIGlmIChpc05hTihuYSkpIHtcbiAgICAgICAgICByZXR1cm4gLWl2O1xuICAgICAgICB9IGVsc2UgaWYgKGlzTmFOKG5iKSkge1xuICAgICAgICAgIHJldHVybiBpdjtcbiAgICAgICAgfSBlbHNlIHtcbiAgICAgICAgICByZXR1cm4gaXYgKiAobmEgLSBuYik7XG4gICAgICAgIH1cbiAgICAgIH07XG4gICAgICBkYXRhLnJvd19jb2xfY2VsbHMgPSBkYXRhLnJvd19jb2xfY2VsbHMuc29ydCgoYSwgYikgPT4gc29ydEZ1bmN0aW9uKGEsIGIsIHNvcnRpbmdfcHJvcHMuZGlyZWN0aW9uKSk7XG4gICAgfVxuICB9XG4gIF8uZWFjaChkYXRhLnJvd19jb2xfY2VsbHMsIG8gPT4ge1xuICAgIGlmIChvLm1hcChpdGVtID0+IGl0ZW0uaGlkZGVuLnRvU3RyaW5nKCkpLmluZGV4T2YoXCJmYWxzZVwiKSA+IC0xKSB7XG4gICAgICBvdXRwdXQuYm9keSArPSBcIjx0cj5cIjtcbiAgICAgIGlmICh0aGlzLmhpZGVfZmlyc3RfY29sdW1uICE9PSB0cnVlKSB7XG4gICAgICAgIGxldCByYXdfcm93TmFtZSA9IChfLmZpcnN0KG8ubWFwKGl0ZW0gPT4gaXRlbS5yb3dfbmFtZV9yYXcpKSk7XG4gICAgICAgIG91dHB1dC5ib2R5ICs9IGBcbiAgICAgICAgICAgICAgICAgICAgPHRkIHN0eWxlPVwiJHt0aGlzLnVuaXRfc3R5bGVfZXh0fTt0ZXh0LWFsaWduOiR7dGhpcy50ZXh0X2FsaWdubWVudF9maXJzdGNvbHVtbn1cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICR7Z2V0TGlua2lmaWVkQ29sdW1uKF8uZmlyc3Qoby5tYXAoaXRlbSA9PiBpdGVtLnJvd19uYW1lKSksIFN0cmluZyh0aGlzLmZpcnN0X2NvbHVtbl9saW5rKSwgcmF3X3Jvd05hbWUpfVxuICAgICAgICAgICAgICAgICAgICA8L3RkPmA7XG4gICAgICB9XG4gICAgICBfLmVhY2gobywgaXRlbSA9PiB7XG4gICAgICAgIGlmICggc29ydGluZ19wcm9wcy5oaWRkZW5fY29scy5pbmRleE9mKCBpdGVtLmNvbF9uYW1lICkgPT09IC0xICl7XG4gICAgICAgICAgaWYgKGl0ZW0uZGlzcGxheV92YWx1ZSA9PT0gdW5kZWZpbmVkKXtcbiAgICAgICAgICAgIGl0ZW0uZGlzcGxheV92YWx1ZSA9IFwiLVwiO1xuICAgICAgICAgIH1cbiAgICAgICAgICBsZXQgaXRlbV9zdHlsZSA9IGAke3RoaXMudW5pdF9zdHlsZV9leHR9O2JhY2tncm91bmQtY29sb3I6JHtpdGVtLmNvbG9yX2JnfTtjb2xvcjoke1xuICAgICAgICAgICAgaXRlbS5jb2xvcl90ZXh0XG4gICAgICAgICAgICB9O3RleHQtYWxpZ246JHt0aGlzLnRleHRfYWxpZ25tZW50X3ZhbHVlc31gO1xuICAgICAgICAgIGxldCBpdGVtX2Rpc3BsYXkgPSAoaXRlbS5saW5rID09PSBcIiNcIikgPyBpdGVtLmRpc3BsYXlfdmFsdWVcbiAgICAgICAgICAgICAgOiBgPGEgaHJlZj1cIiR7aXRlbS5saW5rfVwiIHRhcmdldD1cIl9ibGFua1wiIHN0eWxlPVwiY29sb3I6JHtpdGVtLmNvbG9yX3RleHR9XCI+JHtpdGVtLmRpc3BsYXlfdmFsdWV9PC9hPmA7XG4gICAgICAgICAgbGV0IHRvb2x0aXAgPSAoIWl0ZW0udG9vbHRpcCB8fCBpdGVtLnRvb2x0aXAgPT09IFwiLVwiKSA/IHVuZGVmaW5lZFxuICAgICAgICAgICAgICA6IGAgZGF0YS10b2dnbGU9XCJ0b29sdGlwXCIgZGF0YS1odG1sPVwidHJ1ZVwiIGRhdGEtcGxhY2VtZW50PVwidG9wXCIgdGl0bGU9XCIke1xuICAgICAgICAgICAgICAgIGl0ZW0udG9vbHRpcC5yZXBsYWNlKC9cXFwiL2csICcmIzM0OycpXG4gICAgICAgICAgICAgIH1cIiBgO1xuICAgICAgICAgIG91dHB1dC5ib2R5ICs9IGBcbiAgICAgICAgICAgICAgICAgICAgICA8dGQgc3R5bGU9XCIke2l0ZW1fc3R5bGV9ICR7dG9vbHRpcH1cIj5cbiAgICAgICAgICAgICAgICAgICAgICAgICAgJHt0b29sdGlwID8gYDxzcGFuICR7dG9vbHRpcH0+YCA6IFwiXCJ9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAke2l0ZW1fZGlzcGxheSA/IGAke2l0ZW1fZGlzcGxheX1gIDogXCImbmJzcFwifVxuICAgICAgICAgICAgICAgICAgICAgICAgICAke3Rvb2x0aXAgPyBgPC9zcGFuPmAgOiBcIlwifVxuICAgICAgICAgICAgICAgICAgICAgIDwvdGQ+XG4gICAgICAgICAgICAgICAgICBgO1xuICAgICAgICB9XG4gICAgICB9KTtcbiAgICAgIG91dHB1dC5ib2R5ICs9IFwiPC90cj5cIjtcbiAgICB9XG4gIH0pO1xuICAvLyBjb25zb2xlLmxvZyggXCJodG1sOiBcIiwgb3V0cHV0LmJvZHkgKTtcbiAgcmV0dXJuIG91dHB1dDtcbn07XG5Cb29tT3V0cHV0LnByb3RvdHlwZS5nZXREYXRhQXNEZWJ1Z0hUTUwgPSBmdW5jdGlvbiAoZGF0YTogSUJvb21TZXJpZXNbXSk6IHN0cmluZyB7XG4gIGxldCBkZWJ1Z2RhdGEgPSBgYDtcbiAgZGVidWdkYXRhID0gXy5tYXAoZGF0YSwgZCA9PiB7XG4gICAgcmV0dXJuIGBcbiAgICAgICAgPHRyPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjMwJTsgdGl0bGU9XCJTZXJpZXMgTmFtZVwiID4ke2Quc2VyaWVzTmFtZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJNYXRjaGluZyBQYXR0ZXJuIE5hbWVcIiA+JHtkLnBhdHRlcm4ubmFtZSB8fCBkLnBhdHRlcm4ucGF0dGVybiB8fCBcIkRlZmF1bHRcIn08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJWYWx1ZSA6ICR7U3RyaW5nKGQudmFsdWVfZm9ybWF0dGVkIHx8IFwibnVsbFwiKX0gLyBSYXcgOiAke1N0cmluZyhkLnZhbHVlIHx8IFwibnVsbFwiKX0gLyBTdGF0IDogJHtkLnBhdHRlcm4udmFsdWVOYW1lfVwiPiR7ZC5kaXNwbGF5X3ZhbHVlfTwvdGQ+XG4gICAgICAgICAgICA8dGQgc3R5bGU9XCJwYWRkaW5nOjRweDt0ZXh0LWFsaWduOmxlZnQ7d2lkdGg6MTAlOyB0aXRsZT1cIlJvdyBuYW1lXCIgPiR7ZC5yb3dfbmFtZX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJDb2wgbmFtZVwiID4ke2QuY29sX25hbWV9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVGhyZXNob2xkc1wiID4ke2QudGhyZXNob2xkcy5qb2luKFwiLFwiKX08L3RkPlxuICAgICAgICAgICAgPHRkIHN0eWxlPVwicGFkZGluZzo0cHg7dGV4dC1hbGlnbjpsZWZ0O3dpZHRoOjEwJTsgdGl0bGU9XCJCRyBDb2xvclwiID4ke2QuY29sb3JfYmd9PC90ZD5cbiAgICAgICAgICAgIDx0ZCBzdHlsZT1cInBhZGRpbmc6NHB4O3RleHQtYWxpZ246bGVmdDt3aWR0aDoxMCU7IHRpdGxlPVwiVGV4dCBDb2xvclwiID4ke2QuY29sb3JfdGV4dH08L3RkPlxuICAgICAgICA8L3RyPlxuICAgICAgICBgO1xuICB9KS5qb2luKGBgKTtcbiAgcmV0dXJuIGRlYnVnZGF0YTtcbn07XG4iXX0=